{% assign common_version = 'v_001' %}

<div id="occupancy">
	{% assign step = '3' -%}
	{% include 'modules/visualnav' -%}
	{% include 'modules/feedback' -%}
	
	<div class="room-actions">
		<a href="#" class="new_search" onclick="Modalbox.show($('loadingbox1'),{width: 600, top:125,inactiveFade:false});Modalbox.deactivate();$('availability_search_form').submit();">Add another room type</a>
	</div>
	
	<div class="occupancy-checkin"> 
	<p><strong>Check in:</strong> {{ arrival_date }} - <strong>Nights:</strong> {{ nights }}</p>
	</div>
	
	<div id="rooms" class="occupancy-rooms"> 
	
		{% for room in rate_search_container.items -%}
			<h2>{{ room.room_type_name}}</h2>
			<div class="room-actions">
				<a href="/web_reservations/add_room?rate_room_type={{ room.rate_room_type_id }}" onclick="Modalbox.show($('loadingbox2'),{width: 600,top:125,inactiveFade:false});Modalbox.deactivate();" class="add_room">Add another {{ room.room_type_name }}</a>
				<a href="/web_reservations/remove_room/?room_item={{ room.id }}" class="rem_room">Remove this room</a>
			</div>
			
			<div class="box">
				<form id="room_form_{{ room.id }}" class="occupancy" action="ajax_update_room" method="post" onsubmit="new Ajax.Updater('rooms', 'ajax_update_room', {asynchronous:true, evalScripts:true, parameters:Form.serialize(this)}); return false;">			
				<fieldset>
					<p class="title">Occupancy:</p>
					<p><label>Adults:</label>{{ room.select_adults }}</p>
					<p><label>Children:</label>{{ room.select_children }}</p>			
					<p class="hide"><input type="hidden" name="id" value="{{ room.id}}" /></p>
				</fieldset>
				
				<!-- fieldset>
					<p class="title">Options:</p>				
					<p class="hide"><input type="hidden" name="breakfast" value="0" id="breakfast" /></p>
					<p><label for="breakfast">Breakfast:</label>{{ room.select_breakfast }}</p>			
				</fieldset -->
				
				{% if room.is_ticket_rate %}
					<fieldset>
						<p class="title">Tickets:</p>				
						<p><label>
							{% for event in room.event_names %}
								{{ room.people }} ticket(s) for {{ event }} on {{ rate_search_container.arrival_date | format_date_to: 'eu' }}
							{% endfor %}
							</label>			
						</p>			
					</fieldset>		
				{% endif %}
				</form>
				<p class="roomprice clearfix"><strong>Room price:</strong><span id="price_{{ room.id }}"> &euro;{{ room.price | format_decimal }}</span></p>
				<div class="loading-room" id="loading_{{ room.id }}" style="display:none;">Loading...</div>
			</div>
		{% endfor -%}
		
			
		<p id="occupancy-total">
			<strong>Total:</strong> <span id="total_price">&euro;{{ rate_search_container.total_price | format_decimal}}</span><br />
			{% if rate_search_container.deposit_chared %}<span style="font-size: 0.8em"><strong>Deposit:</strong> &euro;{{ rate_search_container.charged_price | format_decimal }}</span>{% endif %}
		</p>
		{% if customer_setting.booking_fee > 0 %}<p>Total Price includes a booking fee of {{ customer_setting.booking_fee | format_money: '&euro;' }} </p>{% endif %}
		<!--All of these rooms are bookable? {{ rate_search_container.valid }}-->
	
		<!-- include 'rooms_table' -->
	</div>

	<div class="buttons">
		<!-- a href="{{ html.checkout_action }}" id="proceed" onclick="Modalbox.show($('loadingbox2'),{width: 600,top: 125,inactiveFade:false});Modalbox.deactivate();"><span class="alt">Proceed</span></a -->
		<button id="proceed" onclick="Modalbox.show($('loadingbox2'),{width: 600,top: 125,afterLoad: function () {location.href='{{ html.checkout_action }}'}, inactiveFade:false});Modalbox.deactivate();">Proceed</button>
	</div>
	<div id="loadingbox2" class="loadingbox" style="display:none;">
		<h3>Proceeding</h3>
		<p>Please wait...</p>
		<div class="loader"> </div>
	</div>

	<script type="text/javascript">
		Ajax.Responders.register({
			onComplete: function() {
				new Effect.Highlight("occupancy-total"); 
			}
		}); 
	</script>

</div>
